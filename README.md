# Домашнее задание к занятию "10.01. Зачем и что нужно мониторить"

## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя 
платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. Взаимодействие с платформой 
осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы
выведите в мониторинг и почему?


Для данного сервиса в мониторинг потребуется вывести следующие метрики: 

CPU user time - насколько процессор загружен процессами пользователя

CPU system time - насколько процессор загружен процессами системы

CPU iowait time - сколько времени процессор находится в режиме ожидания операций ввод/вывода

также следует следить за load average - если больше единицы, значит за момент времени (минута, 5 минут, 15 минут), число процессов равное LA находилось в очереди.

количество inodes

Disk IO read/write - операции ввода/вывода в секунду

Disk Activity read/write - объем данных в единицу времени

Т.к. данные сохраняются на диск, потребуется метрика - доступное место на файловой системе, чтобы в нужный момент принимать решение о добавлении дискового пространства или, например отправке части данных в "архив"

проверка доступности платформы по http

метрики на уровне кодов ответа

уровень ошибок (коды 4ХХ, 5ХХ)

принято/отправлено пакетов в единицу времени

принято/отправлено байт в единицу времени

ошибки при приеме/передаче

загрузка сетевого канала

2. Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. Также он сказал, 
что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы 
можете ему предложить?

Предложу явно или неявно заключить соглашение об уровне обслуживания с клиентами - SLA, также надо указать целевой уровень качества обслуживания - SLO, это то, к чему стремится SLA, а в качестве метрики надо использовать индикатор качества обслуживания - SLI, это фактические показатели качества обслуживания, для выполнения SLA они должны стремиться к SLO.

3. Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики в свою 
очередь хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, 
чтобы разработчики получали ошибки приложения?

для централизованного хранения и обработки логов можно применить опенсорсные стеки: ELK, graylog, loki, Monq, в последнее время актуальной становится связка - Vector, ClickHouse, Grafana - VCG. 
Для мониторинга ошибок фронтенд приложений можно использовать Sentry. Если железа для установки предложенного ПО нет, можно использовать бесплатое облачное решение Sentry. Удобные бесплатные облачные решения для центрального хранения и анализа логов найти сложнее, под капотом у них в большинстве случаев будут уже озвученные решения.

3. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. 
Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. Данный параметр не поднимается выше 
70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

Ошибка в том, что не учтены 3хх коды ответов (300: коды перенаправления возвращаются, когда запрошенный ресурс заменен новым), 

Правильная формула выглядит так: (summ_2xx_requests + summ_3xx_requests)/summ_all_requests.


## Дополнительное задание (со звездочкой*) - необязательно к выполнению

Вы устроились на работу в стартап. На данный момент у вас нет возможности развернуть полноценную систему 
мониторинга, и вы решили самостоятельно написать простой python3-скрипт для сбора основных метрик сервера. Вы, как 
опытный системный-администратор, знаете, что системная информация сервера лежит в директории `/proc`. 
Также, вы знаете, что в системе Linux есть  планировщик задач cron, который может запускать задачи по расписанию.

Суммировав все, вы спроектировали приложение, которое:
- является python3 скриптом
- собирает метрики из папки `/proc`
- складывает метрики в файл 'YY-MM-DD-awesome-monitoring.log' в директорию /var/log 
(YY - год, MM - месяц, DD - день)
- каждый сбор метрик складывается в виде json-строки, в виде:
  + timestamp (временная метка, int, unixtimestamp)
  + metric_1 (метрика 1)
  + metric_2 (метрика 2)
  
     ...
     
  + metric_N (метрика N)
  
- сбор метрик происходит каждую 1 минуту по cron-расписанию

Для успешного выполнения задания нужно привести:

а) работающий код python3-скрипта,

[скрипт мониторинга](./procfs_exporter.py)

б) конфигурацию cron-расписания,
```shell
~/netology/run-mnt-homeworks/10-monitoring-01-base$ crontab -l
# m h  dom mon dow   command
* * * * * /home/dmitriy/netology/run-mnt-homeworks/10-monitoring-01-base/procfs_exporter.py 
```

в) пример верно сформированного 'YY-MM-DD-awesome-monitoring.log', имеющий не менее 5 записей,

```shell
~/netology/run-mnt-homeworks/10-monitoring-01-base$ cat /var/log/2022-10-18-awesome-monitoring.log 
{"timestamp": 1666042921365837725, "load average": 2.26, "iowait": 0.0, "mem_available": 1466292, "swap_free": 13753184, "mem_active": 1656900}
{"timestamp": 1666042981439034883, "load average": 1.47, "iowait": 0.0, "mem_available": 1494848, "swap_free": 13753184, "mem_active": 1657256}
{"timestamp": 1666043041519584723, "load average": 1.29, "iowait": 0.0, "mem_available": 1487744, "swap_free": 13753184, "mem_active": 1657680}
{"timestamp": 1666043101605946053, "load average": 3.45, "iowait": 0.0, "mem_available": 1472744, "swap_free": 13753440, "mem_active": 1658560}
{"timestamp": 1666043161689969665, "load average": 1.65, "iowait": 0.08, "mem_available": 1497252, "swap_free": 13753440, "mem_active": 1678912}
{"timestamp": 1666043221749009878, "load average": 1.1, "iowait": 0.08, "mem_available": 1503780, "swap_free": 13753440, "mem_active": 1668640}
{"timestamp": 1666043281841746152, "load average": 1.13, "iowait": 0.0, "mem_available": 1493928, "swap_free": 13753440, "mem_active": 1669048}
{"timestamp": 1666043341897694531, "load average": 0.63, "iowait": 0.0, "mem_available": 1474660, "swap_free": 13753440, "mem_active": 1666980}
{"timestamp": 1666043401987861633, "load average": 0.65, "iowait": 0.0, "mem_available": 1404624, "swap_free": 13740128, "mem_active": 1659916}
```
(Лог, создаваемый скриптом)[./2022-10-18-awesome-monitoring.log]

Выходной формат скрипта позволяет быстро анализировать лог программами, т.к. его не надо разбивать на поля, но при этом остается легко читаемым для человека, также лог является надежным, потому что новая json-строка записывается в конец файла и не зависит от объема файла и возможных ошибок формата, которые были выше. 

P.S.: количество собираемых метрик должно быть не менее 4-х.
P.P.S.: по желанию можно себя не ограничивать только сбором метрик из `/proc`.

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
